<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stream 2 Night</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(to bottom, #1b103f, #090d28); }
    .tab-button { padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 0 0 1px rgba(255,255,255,0.1); font-size: 1.1rem; }
    .active-tab { background: linear-gradient(to right, #7f5af0, #2cb67d); color: white; box-shadow: 0 0 10px rgba(127, 90, 240, 0.6);}
    .inactive-tab { background-color: #2e2e3a; color: #a0aec0;}
    .inactive-tab:hover { background-color: #3a3a4d; color: #ffffff;}
    .flag-tab { border-radius: 9999px; padding: 0.5rem 0.9rem; font-size: 1.85rem; background: #222; border: 2px solid transparent; margin: 0 0.25rem; transition: 0.2s; box-shadow: 0 2px 12px 0 rgba(90,90,120,0.06); outline: none; display: flex; align-items: center; justify-content: center; line-height: 1; height: 3.2rem; width: 3.7rem; }
    .flag-tab.selected { background: linear-gradient(to right, #7f5af0, #2cb67d); color: white; border-color: #fff; filter: brightness(1.15) drop-shadow(0 2px 8px #7f5af088);}
    .flag-img { width: 2.2rem; height: 1.6rem; border-radius: 0.4rem; object-fit: cover; display: block;}
    .wild-btn { margin-left: 0.75rem; background: linear-gradient(to right, #ffde57, #fc7e1e); color: #1b103f; font-weight: 700; border-radius: 2rem; padding: 0.7rem 1.3rem; font-size: 1.2rem; box-shadow: 0 2px 10px #0003; border: none; transition: 0.2s; }
    .wild-btn:hover { background: linear-gradient(to right, #fc7e1e, #ffde57); color: #111; }
    .wild-modal-bg {
      position: fixed; inset: 0; z-index: 1000; background: rgba(16,12,34,0.97);
      display: flex; align-items: center; justify-content: center; flex-direction: column;
      transition: background 0.3s;
    }
    .wild-cards-stack {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      align-items: flex-end;
      margin-bottom: 1.8rem;
    }
    .wild-card {
      width: 170px;
      height: 250px;
      background: #181621;
      border-radius: 1.2rem;
      box-shadow: 0 10px 40px #0007;
      border: 4px solid gold;
      cursor: pointer;
      transition: transform 0.25s, box-shadow 0.25s;
      position: relative;
      perspective: 1000px;
      z-index: 5;
      user-select: none;
    }
    .wild-card:not(.active) {
      filter: blur(0.5px) grayscale(0.2) brightness(0.94);
      opacity: 0.78;
      z-index: 3;
      pointer-events: none;
      transform: scale(0.93);
    }
    .wild-card.flipped .wild-card-inner {
      transform: rotateY(180deg);
    }
    .wild-card-inner {
      width: 100%; height: 100%;
      position: absolute; top: 0; left: 0;
      transition: transform 0.6s cubic-bezier(.58,.04,.46,1.29);
      transform-style: preserve-3d;
    }
    .wild-card-front, .wild-card-back {
      width: 100%; height: 100%;
      border-radius: 1rem;
      position: absolute; top: 0; left: 0;
      backface-visibility: hidden;
      display: flex; align-items: center; justify-content: center; flex-direction: column;
      font-weight: bold;
    }
    .wild-card-back {
      background: #191624;
      border: 3px solid gold;
      color: gold;
      font-size: 1.1rem;
      letter-spacing: 2px;
      font-family: 'Arial Black', Arial, sans-serif;
      background-image: url('https://cdn.pixabay.com/photo/2014/04/03/10/32/golden-313474_1280.png');
      background-size: cover;
      box-shadow: 0 2px 16px #0009;
    }
    .wild-card-front {
      background: #232145;
      color: #fff;
      transform: rotateY(180deg);
      overflow: hidden;
      padding: 0.5rem;
      text-align: center;
      box-shadow: 0 0 14px #FFD70044;
    }
    .wild-card-front img {
      border-radius: 0.7rem;
      margin-bottom: 0.4rem;
      object-fit: cover;
      width: 90%;
      height: 145px;
      background: #24222a;
    }
    .wild-card-actions {
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1.7rem;
    }
    .wild-card-btn {
      border: none;
      background: #221e3b;
      font-size: 2.2rem;
      color: #fc7e1e;
      padding: 0.2em 0.7em;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 2px 12px #0003;
      opacity: 0.86;
    }
    .wild-card-btn.keep {
      color: #2cb67d;
      background: #1b2930;
    }
    .wild-card-btn:hover { filter: brightness(1.2) scale(1.13);}
    .wild-hand {
      display: flex; gap: 1.1rem; justify-content: center; margin-bottom: 2rem;
    }
    .wild-hand .wild-card {
      width: 120px; height: 180px; border-width: 3px; cursor: pointer;
    }
    .wild-winner {
      text-align: center;
      color: #fc7e1e;
      margin: 2.2rem 0 1.2rem;
      font-size: 2.2rem;
      font-weight: bold;
      letter-spacing: 2px;
    }
    .wild-close-btn {
      background: #181621; color: #fff; font-size: 1.7rem; border: 2px solid #444;
      border-radius: 999px; padding: 0.2em 0.8em; position: absolute; top: 1.4rem; right: 2.6rem; z-index: 2001;
      cursor: pointer; opacity: 0.7; transition: opacity 0.15s;
    }
    .wild-close-btn:hover { opacity: 1;}
    @media (max-width: 768px) {
      .wild-cards-stack { flex-direction: column; align-items: center; gap: 0.7rem;}
      .wild-card { width: 93vw; height: 210px; }
      .wild-card-front img { height: 90px;}
      .wild-hand .wild-card { width: 45vw; height: 110px;}
    }
  </style>
</head>
<body class="text-white">
  <!-- ... keep the rest of your current code here up to your <footer> ... -->

  <!-- Wild Cards Overlay Modal -->
  <div id="wildModal" style="display:none;" class="wild-modal-bg">
    <button class="wild-close-btn" id="wildCloseBtn" title="Close">âœ•</button>
    <div id="wildGameArea"></div>
  </div>

  <!-- Add the rest of your HTML here, including your region/cat tabs and main results area, as you currently have -->

  <!-- Sound FX (audio elements, will play in script) -->
  <audio id="sfxFlip" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124b3c6e77.mp3"></audio>
  <audio id="sfxKeep" src="https://cdn.pixabay.com/audio/2022/03/15/audio_12bc7e30d3.mp3"></audio>
  <audio id="sfxNope" src="https://cdn.pixabay.com/audio/2022/03/15/audio_12be01e730.mp3"></audio>
  <audio id="sfxWin" src="https://cdn.pixabay.com/audio/2022/03/15/audio_12bd46ad83.mp3"></audio>

<!-- PART 2: Script goes here (in the next message) -->
<script>
/** WILD CARD GAME LOGIC **/

// Utility: play SFX by id
function playSfx(id) {
  const s = document.getElementById(id);
  if (s) { s.currentTime = 0; s.play(); }
}

// Utility: sleep
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

// "Logo" for Stream2Night card back (change if you have a real logo!)
const wildCardLogoHTML = `<div style="display:flex;flex-direction:column;align-items:center;">
  <span style="font-size:2.6rem;color:gold;">â˜…</span>
  <span style="font-size:1.1rem;letter-spacing:2px;">STREAM2NIGHT</span>
  <span style="font-size:1.7rem;color:#7f5af0;">ðŸŽ¬</span>
</div>`;

// Hook up modal
const wildModal = document.getElementById('wildModal');
const wildGameArea = document.getElementById('wildGameArea');
const wildCloseBtn = document.getElementById('wildCloseBtn');
if (wildCloseBtn) wildCloseBtn.onclick = () => { wildModal.style.display = 'none'; wildGameArea.innerHTML = ''; };

// Helper: Get current settings
function getWildContext() {
  let type = 'all';
  if (document.getElementById('movieTab').classList.contains('active-tab')) type = 'movie';
  if (document.getElementById('tvTab').classList.contains('active-tab')) type = 'tv';
  let region = 'GB';
  if (document.getElementById('regionUS').classList.contains('selected')) region = 'US';
  if (document.getElementById('regionCA').classList.contains('selected')) region = 'CA';
  return { type, region };
}

// Helper: Fetch random N items (like your main fetch but faster/random)
// For demo, just grabs first 4 pages, shuffles, filters
async function fetchWildCards({type, region}) {
  let tmdbApiKey = '2acda6d77609c7c9b6bce9bdf4e5271f';
  let endpoints = [];
  let label = '';
  if (type === 'all') {
    endpoints = [
      `https://api.themoviedb.org/3/movie/popular?api_key=${tmdbApiKey}&language=en-${region}&page=1`,
      `https://api.themoviedb.org/3/tv/popular?api_key=${tmdbApiKey}&language=en-${region}&page=1`
    ];
    label = 'all';
  } else if (type === 'movie') {
    endpoints = [
      `https://api.themoviedb.org/3/movie/popular?api_key=${tmdbApiKey}&language=en-${region}&page=1`
    ];
    label = 'movie';
  } else {
    endpoints = [
      `https://api.themoviedb.org/3/tv/popular?api_key=${tmdbApiKey}&language=en-${region}&page=1`
    ];
    label = 'tv';
  }
  let results = [];
  for (let ep of endpoints) {
    const r = await fetch(ep); const data = await r.json();
    if (data.results) results = results.concat(data.results.map(x => {
      x.media_type = label === 'all'
        ? (x.title ? 'movie' : 'tv')
        : label;
      return x;
    }));
  }
  // Shuffle
  for (let i = results.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [results[i], results[j]] = [results[j], results[i]];
  }
  // Keep only those with poster + popular enough
  results = results.filter(x => (x.poster_path && (x.vote_count||0) > 90));
  return results.slice(0, 8);
}

// Helper: Check availability in country (TMDB only for speed)
async function fetchWildAvailability(id, mediaType, region) {
  let tmdbApiKey = '2acda6d77609c7c9b6bce9bdf4e5271f';
  const type = mediaType === 'tv' ? 'tv' : 'movie';
  try {
    const tmdbRes = await fetch(`https://api.themoviedb.org/3/${type}/${id}/watch/providers?api_key=${tmdbApiKey}`);
    const tmdbData = await tmdbRes.json();
    const countryData = tmdbData.results?.[region];
    let stream = '';
    if (countryData && countryData.flatrate) stream = 'stream';
    return !!stream;
  } catch { return false; }
}

// MAIN: Wild Card Modal/Deck Flow
async function startWildCards() {
  // 1. Get context
  const ctx = getWildContext();
  wildModal.style.display = 'flex';
  wildGameArea.innerHTML = `<div style="color:#ffde57;font-size:1.5rem;margin-bottom:2.2rem;">Shuffling your deck...</div>`;
  // 2. Get ~5 titles
  let all = await fetchWildCards(ctx);
  let hand = [];
  for (let t of all) {
    if (await fetchWildAvailability(t.id, t.media_type, ctx.region)) {
      hand.push(t);
      if (hand.length >= 5) break;
    }
  }
  if (!hand.length) {
    wildGameArea.innerHTML = `<div class="text-red-300 text-lg mt-12">No available titles found right now.<br>Please try again!</div>`;
    return;
  }
  // 3. Game: Swipe/flip for 5 cards
  let idx = 0, chosen = [];
  renderWildStack(hand, idx, chosen);
}

function renderWildStack(hand, idx, chosen) {
  wildGameArea.innerHTML = `
    <div class="wild-cards-stack">
      ${hand.map((item, i) => `
        <div class="wild-card${i===idx ? ' active' : ''}${i<idx ? ' flipped' : ''}" style="z-index:${10-i}">
          <div class="wild-card-inner">
            <div class="wild-card-back">${wildCardLogoHTML}</div>
            <div class="wild-card-front">
              <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title||item.name}" />
              <div class="text-lg mb-1 font-semibold">${item.title||item.name}</div>
              <div style="font-size:1.03rem;color:#ffe7a7;">${item.media_type==='tv'?'Series':'Movie'}</div>
              <div style="font-size:0.96rem;color:#bdbdbd; margin-top: 0.35rem;">${(item.release_date||item.first_air_date||'').slice(0,4)||''}</div>
              <div class="wild-card-actions">
                <button class="wild-card-btn nope" title="Nope" style="margin-right:0.6rem;">âœ–</button>
                <button class="wild-card-btn keep" title="Keep">âœ”</button>
              </div>
            </div>
          </div>
        </div>
      `).join('')}
    </div>
    <div class="text-center text-gray-300" style="margin-bottom:1.5rem;">${idx+1}/5 - Swipe or tap âœ” or âœ–</div>
  `;
  // Card flip on click
  document.querySelectorAll('.wild-card').forEach((el, i) => {
    if (i === idx && !el.classList.contains('flipped')) {
      el.onclick = () => {
        el.classList.add('flipped');
        playSfx('sfxFlip');
      };
    } else { el.onclick = null; }
  });
  // Action btns
  setTimeout(()=>{
    let actions = document.querySelectorAll('.wild-card.active .wild-card-actions button');
    if (!actions.length) return;
    // âœ” Keep
    actions[1].onclick = async () => {
      playSfx('sfxKeep');
      chosen.push(hand[idx]);
      nextWildCard(hand, idx, chosen);
    };
    // âœ– Nope
    actions[0].onclick = async () => {
      playSfx('sfxNope');
      nextWildCard(hand, idx, chosen);
    };
  }, 400);
}

// Next step in deck
function nextWildCard(hand, idx, chosen) {
  if (idx+1 < hand.length) {
    renderWildStack(hand, idx+1, chosen);
  } else {
    setTimeout(()=> renderWildHand(chosen), 500);
  }
}

// Show picked hand for final round
function renderWildHand(chosen) {
  if (!chosen.length) {
    wildGameArea.innerHTML = `<div class="text-red-200 text-lg mt-12">No titles selected!<br>Try again.</div>`;
    return;
  }
  wildGameArea.innerHTML = `
    <div class="wild-hand">${chosen.map((item,i) => `
      <div class="wild-card" data-wi="${i}" style="z-index:${9-i};">
        <div class="wild-card-inner flipped">
          <div class="wild-card-back">${wildCardLogoHTML}</div>
          <div class="wild-card-front">
            <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title||item.name}" />
            <div class="text-md font-semibold">${item.title||item.name}</div>
            <div style="font-size:0.93rem;color:#ffe7a7;">${item.media_type==='tv'?'Series':'Movie'}</div>
            <div style="font-size:0.88rem;color:#c0c0c0;">${(item.release_date||item.first_air_date||'').slice(0,4)||''}</div>
          </div>
        </div>
      </div>
    `).join('')}</div>
    <div class="text-center text-gray-300" style="margin-bottom:1.4rem;">
      Click a card to pick your winner!
    </div>
  `;
  // Card click = pick winner
  document.querySelectorAll('.wild-hand .wild-card').forEach((el, idx) => {
    el.onclick = () => {
      renderWildWinner(chosen[idx]);
    };
  });
}

// Winner celebration
function renderWildWinner(item) {
  wildGameArea.innerHTML = `
    <div class="wild-winner">Your Wild Card Pick!</div>
    <div class="flex flex-col items-center justify-center">
      <div class="bg-gray-800 p-7 rounded-xl shadow-xl text-center max-w-sm mx-auto" style="border:5px solid gold;">
        <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title||item.name}" class="rounded mb-5 mx-auto" style="max-height:290px; width:auto;">
        <h3 class="text-2xl font-bold mb-3">${item.title||item.name}</h3>
        <div class="text-md text-gray-300 mb-3">
          ${item.media_type==='tv'?'Series':'Movie'}
          ${item.release_date||item.first_air_date ? ` â€¢ ${(item.release_date||item.first_air_date).slice(0,4)}` : ''}
        </div>
      </div>
      <div class="mt-6 text-3xl" style="color:#FFD700;">
        ðŸŽ‰ ðŸŽŠ ðŸ¥³
      </div>
      <button class="wild-close-btn" onclick="wildModal.style.display='none';wildGameArea.innerHTML='';" style="position:static; margin-top:2.4rem;">âœ• Back to site</button>
    </div>
  `;
  playSfx('sfxWin');
}

// Launch from button
document.getElementById('wildBtn').onclick = startWildCards;

</script>

</body>
</html>







