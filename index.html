<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PQB3CSDG');</script>
  <!-- End Google Tag Manager -->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z4PWK187GP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Z4PWK187GP');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Streamline</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script defer>
    const watchmodeApiKey = 'Obbabfda4fmsh11a51996ff09aeap16c8a6jsn6ee377acda63';

    async function searchWatchmode(query) {
      try {
        const searchRes = await fetch(`https://watchmode.p.rapidapi.com/search/?search_value=${encodeURIComponent(query)}&search_type=1`, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': watchmodeApiKey,
            'X-RapidAPI-Host': 'watchmode.p.rapidapi.com'
          }
        });
        const searchData = await searchRes.json();

        const results = searchData.title_results.slice(0, 12); // limit initial batch
        const container = document.getElementById('searchResults');
        container.innerHTML = '';

        for (const item of results) {
          const sourcesRes = await fetch(`https://watchmode.p.rapidapi.com/title/${item.id}/sources/`, {
            method: 'GET',
            headers: {
              'X-RapidAPI-Key': watchmodeApiKey,
              'X-RapidAPI-Host': 'watchmode.p.rapidapi.com'
            }
          });
          const sources = await sourcesRes.json();

          const streamSources = sources.filter(s => s.type === 'sub');
          const logos = streamSources.map(s => `<div class='text-sm text-white border px-2 py-1 rounded mx-1'>${s.name}</div>`).join('');

          const card = document.createElement('div');
          card.className = 'bg-gray-800 p-4 rounded-lg shadow';
          card.innerHTML = `
            <h3 class="text-lg font-semibold mb-2">${item.name}</h3>
            <div class="text-sm text-gray-300">${logos ? `<div class='flex flex-wrap justify-center'>${logos}</div>` : '<span class="text-yellow-400">No streaming data found</span>'}</div>
          `;
          container.appendChild(card);
        }
      } catch (err) {
        console.error('Error fetching from Watchmode:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('searchInput').addEventListener('input', async (e) => {
        const query = e.target.value.trim();
        if (query.length > 2) {
          await searchWatchmode(query);
        }
      });
    });
  </script>
  <style>
    body {
      background: linear-gradient(to bottom, #0f0f1b, #1a1a2e);
    }
  </style>
</head>
<body class="text-white">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PQB3CSDG"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <section class="text-center py-20 px-6">
    <h1 class="text-6xl font-bold mb-4">Streamline</h1>
    <p class="text-xl text-gray-400 mb-6">Smarter streaming, simplified.</p>
    <input id="searchInput" type="text" placeholder="Search for a movie or series..." class="text-black w-full max-w-md px-4 py-2 rounded mb-8" />
    <div id="searchResults" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"></div>
  </section>
  <img src="https://em-content.zobj.net/source/microsoft-teams/337/fox_1f98a.png" alt="Fox" class="fixed top-4 right-4 h-16 w-16 z-50">
  <footer class="text-center p-4 text-gray-400">
    This site uses the TMDb and Utelly APIs but is not endorsed or certified by either.
  </footer>
</body>
</html>

